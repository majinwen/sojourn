<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="house.houseConfMsgDao" >
  <resultMap id="BaseResultMap" type="com.ziroom.minsu.entity.house.HouseConfMsgEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 01 13:03:59 CST 2016.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="fid" property="fid" jdbcType="VARCHAR" />
    <result column="house_base_fid" property="houseBaseFid" jdbcType="VARCHAR" />
    <result column="room_fid" property="roomFid" jdbcType="VARCHAR" />
    <result column="bed_fid" property="bedFid" jdbcType="VARCHAR" />
    <result column="dic_code" property="dicCode" jdbcType="VARCHAR" />
    <result column="dic_val" property="dicVal" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="last_modify_date" property="lastModifyDate" jdbcType="TIMESTAMP" />
    <result column="is_del" property="isDel" jdbcType="INTEGER" />
  </resultMap>
 
  <sql id="Base_Column_List" >
    hc.id, hc.fid, hc.house_base_fid, hc.room_fid, hc.bed_fid, hc.dic_code, hc.dic_val, hc.create_date, hc.last_modify_date, 
    hc.is_del
  </sql>
  
  <!-- 根据房源基础信息逻辑id与房源配置code查询房源配置信息 -->
  <select id="findHouseConfMsgByBaseFidAndDicCode" resultMap="BaseResultMap" parameterType="com.ziroom.minsu.entity.house.HouseConfMsgEntity" >
    select 
    <include refid="Base_Column_List" />
    from t_house_conf_msg hc
    where hc.house_base_fid = #{houseBaseFid,jdbcType=VARCHAR}
    and hc.dic_code = #{dicCode,jdbcType=VARCHAR}
    and hc.is_del = 0
    limit 1
  </select>
  
  <delete id="delHouseConfByFid" parameterType="map" >
    delete from t_house_conf_msg
    where fid = #{fid,jdbcType=VARCHAR}
  </delete>
  
  <!-- 根据房源fid删除房源配置信息-->
  <update id="deleteHouseConfMsgByHouseFid" parameterType="map" >
  	update t_house_conf_msg hc set hc.is_del = 1
  	where hc.house_base_fid = #{fid,jdbcType=VARCHAR}
  </update>
 
  <insert id="insertHouseConfMsg" parameterType="com.ziroom.minsu.entity.house.HouseConfMsgEntity" >
    insert into t_house_conf_msg
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="fid != null" >
        fid,
      </if>
      <if test="houseBaseFid != null" >
        house_base_fid,
      </if>
      <if test="roomFid != null" >
        room_fid,
      </if>
      <if test="bedFid != null" >
        bed_fid,
      </if>
      <if test="dicCode != null" >
        dic_code,
      </if>
      <if test="dicVal != null" >
        dic_val,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date,
      </if>
      <if test="isDel != null" >
        is_del,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="fid != null" >
        #{fid,jdbcType=VARCHAR},
      </if>
      <if test="houseBaseFid != null" >
        #{houseBaseFid,jdbcType=VARCHAR},
      </if>
      <if test="roomFid != null" >
        #{roomFid,jdbcType=VARCHAR},
      </if>
      <if test="bedFid != null" >
        #{bedFid,jdbcType=VARCHAR},
      </if>
      <if test="dicCode != null" >
        #{dicCode,jdbcType=VARCHAR},
      </if>
      <if test="dicVal != null" >
        #{dicVal,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyDate != null" >
        #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        #{isDel,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
 
  <update id="updateHouseConfMsgByFid" parameterType="com.ziroom.minsu.entity.house.HouseConfMsgEntity" >
    update t_house_conf_msg
    <set >
      <if test="fid != null" >
        fid = #{fid,jdbcType=VARCHAR},
      </if>
      <if test="houseBaseFid != null" >
        house_base_fid = #{houseBaseFid,jdbcType=VARCHAR},
      </if>
      <if test="roomFid != null" >
        room_fid = #{roomFid,jdbcType=VARCHAR},
      </if>
      <if test="bedFid != null" >
        bed_fid = #{bedFid,jdbcType=VARCHAR},
      </if>
      <if test="dicCode != null" >
        dic_code = #{dicCode,jdbcType=VARCHAR},
      </if>
      <if test="dicVal != null" >
        dic_val = #{dicVal,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        is_del = #{isDel,jdbcType=INTEGER},
      </if>
    </set>
    where fid = #{fid,jdbcType=VARCHAR}
  </update>

  <!--根据房源fid更新配置信息-->
  <update id="updateHouseConfMsgByHouseBaseFid" parameterType="com.ziroom.minsu.entity.house.HouseConfMsgEntity" >
    update t_house_conf_msg
    <set >
      <if test="fid != null" >
        fid = #{fid,jdbcType=VARCHAR},
      </if>
      <if test="houseBaseFid != null" >
        house_base_fid = #{houseBaseFid,jdbcType=VARCHAR},
      </if>
      <if test="roomFid != null" >
        room_fid = #{roomFid,jdbcType=VARCHAR},
      </if>
      <if test="bedFid != null" >
        bed_fid = #{bedFid,jdbcType=VARCHAR},
      </if>
      <if test="dicCode != null" >
        dic_code = #{dicCode,jdbcType=VARCHAR},
      </if>
      <if test="dicVal != null" >
        dic_val = #{dicVal,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        is_del = #{isDel,jdbcType=INTEGER},
      </if>
    </set>
    where house_base_fid = #{houseBaseFid,jdbcType=VARCHAR}
  </update>
<!-- 通过housebasefid roomfid 以及diccode去更新数据-->
  <update id="updateHouseConfMsgByother" parameterType="com.ziroom.minsu.entity.house.HouseConfMsgEntity" >
    update t_house_conf_msg
    <set >
      <if test="fid != null" >
        fid = #{fid,jdbcType=VARCHAR},
      </if>
      <if test="houseBaseFid != null" >
        house_base_fid = #{houseBaseFid,jdbcType=VARCHAR},
      </if>
      <if test="roomFid != null" >
        room_fid = #{roomFid,jdbcType=VARCHAR},
      </if>
      <if test="bedFid != null" >
        bed_fid = #{bedFid,jdbcType=VARCHAR},
      </if>
      <if test="dicCode != null" >
        dic_code = #{dicCode,jdbcType=VARCHAR},
      </if>
      <if test="dicVal != null" >
        dic_val = #{dicVal,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        is_del = #{isDel,jdbcType=INTEGER},
      </if>
    </set>
    where house_base_fid= #{houseBaseFid,jdbcType=VARCHAR}
      <if test="roomFid != null and roomFid !=''  and roomFid !='null' " >
        AND room_fid = #{roomFid,jdbcType=VARCHAR}
      </if>
        AND dic_code = #{dicCode,jdbcType=VARCHAR}
  </update>

  <!-- 通过房源基础信息逻辑id和房源配置code集合查询房源配置集合 -->
  <select id="findConfListByHouseFidAndCodeList" resultMap="BaseResultMap" parameterType="map" >
    select 
    <include refid="Base_Column_List" />
    from t_house_conf_msg hc
    <where>
    <if test="houseConfList != null and houseConfList.size >0">
		and hc.dic_code in
        <foreach collection="houseConfList"  item="houseConfMsg" open="(" separator="," close=")">  
            #{houseConfMsg.dicCode,jdbcType=VARCHAR}  
        </foreach> 
	</if>
	and hc.house_base_fid = #{houseBasefid,jdbcType=VARCHAR}
	and hc.is_del = 0
	</where>
  </select>
  
  <!-- 房源id查询配置信息 -->
  <select id="findHouseConfList" resultMap="BaseResultMap" parameterType="string" >
    SELECT
    <include refid="Base_Column_List" />
    FROM t_house_conf_msg hc
    WHERE hc.house_base_fid = #{fid,jdbcType=VARCHAR}
	AND hc.is_del = 0
  </select>

  <select id="findRoomConfList" resultMap="BaseResultMap" parameterType="string" >
    SELECT
    <include refid="Base_Column_List" />
    FROM t_house_conf_msg hc
    WHERE hc.room_fid = #{roomFid,jdbcType=VARCHAR}
    AND hc.is_del = 0
  </select>

  <!-- 为价格不同设定提供的配置项集合查询-->
  <select id="findGapFlexPriceList" resultMap="BaseResultMap" parameterType="com.ziroom.minsu.entity.house.HouseConfMsgEntity" >
    SELECT
    <include refid="Base_Column_List" />
    FROM t_house_conf_msg hc
    WHERE 1 = 1 
    <if test="houseBaseFid != null" >
      AND  hc.house_base_fid = #{houseBaseFid,jdbcType=VARCHAR}
    </if>
    <if test="roomFid != null and roomFid !=''  and roomFid !='null' " >
      AND hc.room_fid = #{roomFid,jdbcType=VARCHAR}
    </if>
    <if test="dicCode != null" >
      AND hc.dic_code like CONCAT(#{dicCode,jdbcType=VARCHAR},'%')
    </if>
    <if test="isDel != null" >
      AND hc.is_del = #{isDel,jdbcType=INTEGER}
    </if>
  </select>
  
  <!-- 根据房源基础信息逻辑id与房源配置code查询房源配置信息集合 -->
  <select id="findHouseConfListByFidAndCode" resultType="string" parameterType="map" >
    select hc.dic_val
    from t_house_conf_msg hc
    where hc.house_base_fid = #{houseBaseFid,jdbcType=VARCHAR}
    and hc.dic_code = #{dicCode,jdbcType=VARCHAR}
    and hc.is_del = 0
  </select>
  
  <!-- 配置项map -->
  <resultMap type="com.ziroom.minsu.services.house.entity.HouseConfVo" id="houseConfMap">
  	<result column="dic_code" property="dicCode" jdbcType="VARCHAR" />
    <result column="dic_val" property="dicValue" jdbcType="VARCHAR" />
    <result column="fid" property="fid" jdbcType="VARCHAR" />
  </resultMap> 
  
  <!-- 模糊查询code子项的值配置 -->
  <select id="findHouseConfListByCode"  resultMap="houseConfMap" parameterType="map">
  	SELECT fid, dic_code, dic_val FROM t_house_conf_msg
	WHERE is_del=0
	AND house_base_fid=#{houseBaseFid,jdbcType=VARCHAR}
	AND dic_code LIKE CONCAT(#{dicCode},'%' ) 
  </select>
  
  <!-- 删除房源配置信息根据code -->
  <delete id="delHouseConfByCode"  parameterType="map">
  	DELETE FROM t_house_conf_msg
	WHERE house_base_fid=#{houseBaseFid,jdbcType=VARCHAR}
	AND dic_code LIKE CONCAT(#{dicCode},'%' ) 
  </delete>
  
   <!-- 删除房源配置信息根据code -->
  <delete id="delHouseConfByLikeCode"  parameterType="map">
  	DELETE FROM t_house_conf_msg
	WHERE house_base_fid=#{houseBaseFid,jdbcType=VARCHAR}
	AND dic_code LIKE CONCAT(#{dicCode},'%' )
	<if test="roomFid != null and roomFid !=''" >
      and room_fid = #{roomFid,jdbcType=VARCHAR}
    </if> 
  </delete>
  
  <!-- 根据房源fid 查询押金配置 -->
  <select id="findHouseDepositConfByHouseFid" resultMap="houseConfMap" parameterType="java.lang.String" >
    SELECT cof.dic_code, cof.dic_val,cof.fid FROM `t_house_base_ext` ex 
	 INNER JOIN `t_house_conf_msg` cof ON ( ex.`house_base_fid` = cof.house_base_fid 
	 AND cof.dic_code = ex.`deposit_rules_code` )	 
	 WHERE ex.`house_base_fid` = #{houseBaseFid,jdbcType=VARCHAR}  LIMIT 1
  </select>
  
  <!--查询房间押金配置 -->
  <select id="findRoomDepositConfByRoomFid" resultMap="houseConfMap" parameterType="java.lang.String" >
    SELECT cof.dic_code, cof.dic_val,cof.fid FROM `t_house_room_ext` rex 
	 INNER JOIN `t_house_conf_msg` cof ON ( rex.`room_fid` = cof.`room_fid`
	 AND cof.dic_code = rex.`deposit_rules_code` )	 
	 WHERE rex.`room_fid` = #{roomFid,jdbcType=VARCHAR}   LIMIT 1
  </select>
  
   <!-- 根据房源housefid,roomFid,dicCode 删除押金配置  -->
  <delete id="delHouseConfByParmas"  parameterType="map">
  	DELETE FROM t_house_conf_msg
	WHERE house_base_fid=#{houseBaseFid,jdbcType=VARCHAR}
	AND room_fid=#{roomFid,jdbcType=VARCHAR}
	AND dic_code LIKE CONCAT(#{dicCode},'%' ) 
  </delete>
  
   <!-- 查询配置集合 -->
  <select id="findHouseConfValidList" resultMap="BaseResultMap" parameterType="map" >
    select 
    	<include refid="Base_Column_List" />
    from t_house_conf_msg hc
    where hc.is_del = 0
    <if test="houseBaseFid != null and houseBaseFid !=''" >
	  and hc.house_base_fid = #{houseBaseFid,jdbcType=VARCHAR}
    </if>
    <if test="roomFid != null and roomFid !=''" >
      and hc.room_fid = #{roomFid,jdbcType=VARCHAR}
    </if>
    and hc.dic_code = #{dicCode,jdbcType=VARCHAR}
  </select>

    <!--删除房间配置信息-->
    <update id="delHouseRoomConf" parameterType="map">
    update t_house_conf_msg
    SET is_del = 1
    WHERE house_base_fid=#{houseBaseFid,jdbcType=VARCHAR}
    AND room_fid=#{roomFid,jdbcType=VARCHAR}

  </update>
  
  <!-- 合租转整租删除合租配置-->
  <delete id="delRoomConfByHouseBaseFid"  parameterType="map">
  	DELETE FROM `t_house_conf_msg`
	WHERE house_base_fid=#{houseBaseFid,jdbcType=VARCHAR}
	AND room_fid IS NOT NULL
  </delete>
  
</mapper>

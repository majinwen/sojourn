<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cms.activityGroupReceiveLogDao" >

  <resultMap id="BaseResultMap" type="com.ziroom.minsu.entity.cms.ActivityGroupReceiveLogEntity" >
    <!--
      基础map
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="fid" property="fid" jdbcType="VARCHAR" />
    <result column="uid" property="uid" jdbcType="VARCHAR" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="group_sn" property="groupSn" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="is_del" property="isDel" jdbcType="TINYINT" />
  </resultMap>
  
  <sql id="Base_Column_List" >
    <!--
    基础字段
    -->
    id, fid, uid, mobile, group_sn, create_date, is_del
  </sql>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 25 11:59:27 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_activity_group_receive_log
    where id = #{id,jdbcType=INTEGER}
  </select>
  


  <insert id="insertActivityGroupReceiveLog" parameterType="com.ziroom.minsu.entity.cms.ActivityGroupReceiveLogEntity" >
    <!--
    插入活动组领取记录
    -->
    insert into t_activity_group_receive_log
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="fid != null" >
        fid,
      </if>
      <if test="uid != null" >
        uid,
      </if>
      <if test="mobile != null" >
        mobile,
      </if>
      <if test="groupSn != null" >
        group_sn,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="isDel != null" >
        is_del,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="fid != null" >
        #{fid,jdbcType=VARCHAR},
      </if>
      <if test="uid != null" >
        #{uid,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="groupSn != null" >
        #{groupSn,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        #{isDel,jdbcType=TINYINT},
      </if>
    </trim>
  </insert>
  

  <update id="updateByPrimaryKeySelective" parameterType="com.ziroom.minsu.entity.cms.ActivityGroupReceiveLogEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 25 11:59:27 CST 2017.
    -->
    update t_activity_group_receive_log
    <set >
      <if test="fid != null" >
        fid = #{fid,jdbcType=VARCHAR},
      </if>
      <if test="uid != null" >
        uid = #{uid,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        mobile = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="groupSn != null" >
        group_sn = #{groupSn,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        is_del = #{isDel,jdbcType=TINYINT},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="countGroupReceiveLogByUidAndGroupSn" resultType="java.lang.Long"  parameterType="map" >
    SELECT COUNT(1)
    FROM t_activity_group_receive_log
    WHERE uid =#{uid,jdbcType=VARCHAR}
    AND group_sn=#{groupSn,jdbcType=VARCHAR}
   
  </select>
  
  
  <select id="countGroupReceiveLogByMobileAndGroupSn" resultType="java.lang.Long"  parameterType="map" >
    SELECT COUNT(1)
    FROM t_activity_group_receive_log
    WHERE mobile =#{mobile,jdbcType=VARCHAR}
    AND group_sn=#{groupSn,jdbcType=VARCHAR}
   
  </select>
  
  <!-- 手机号查询排名 -->
  <select id="getMobileRank"  parameterType="map"  resultType="int">
	SELECT temp.num FROM (SELECT (@i:=@i+1) num,uid,mobile,group_sn FROM `t_activity_group_receive_log`,(SELECT @i:=0) AS it
	WHERE group_sn=#{groupSn,jdbcType=VARCHAR}
	ORDER BY create_date) temp
	WHERE 1=1
	<if test="uid!=null and uid!=''">
	   and uid=#{uid,jdbcType=VARCHAR}
	</if>
	<if test="mobile!=null and mobile!=''">
	   and mobile=#{mobile,jdbcType=VARCHAR}
	</if>
  </select>
</mapper>
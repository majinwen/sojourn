<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cms.columnCityDao" >
  <resultMap id="BaseResultMap" type="com.ziroom.minsu.entity.cms.ColumnCityEntity" >
    <!--
    基础map
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="fid" property="fid" jdbcType="VARCHAR" />
    <result column="temp_fid" property="tempFid" jdbcType="VARCHAR" />
    <result column="city_code" property="cityCode" jdbcType="VARCHAR" />
    <result column="col_title" property="colTitle" jdbcType="VARCHAR" />
    <result column="col_deputy_title" property="colDeputyTitle" jdbcType="VARCHAR" />
    <result column="col_share_title" property="colShareTitle" jdbcType="VARCHAR" />
    <result column="col_back_color" property="colBackColor" jdbcType="VARCHAR" />
    <result column="col_status" property="colStatus" jdbcType="TINYINT" />
    <result column="create_fid" property="createFid" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="last_modify_date" property="lastModifyDate" jdbcType="TIMESTAMP" />
    <result column="is_del" property="isDel" jdbcType="TINYINT" />
  </resultMap>
  
  <!-- 分页列表map --> 
  <resultMap type="com.ziroom.minsu.services.cms.entity.ColumnCityVo" id="columnCityListMap" extends="BaseResultMap">
  	<result column="temp_name" property="tempName" jdbcType="VARCHAR" />
  	<result column="temp_type" property="tempType" jdbcType="TINYINT" />
  </resultMap>

  <!-- 查询城市以及其下辖专栏-->
  <resultMap type="com.ziroom.minsu.services.cms.entity.FileRegionsVo" id="FileColRegionMap" extends="BaseResultMap">
    <collection property="regionList"  column="fid" javaType="ArrayList" select="cms.columnRegionDao.findRegionListAndPic"></collection>
  </resultMap>

 
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 09 11:12:52 CST 2016.
    -->
    tcc.id, tcc.fid, tcc.temp_fid, tcc.city_code, tcc.col_title, tcc.col_deputy_title, tcc.col_share_title, tcc.col_back_color, 
    tcc.col_status, tcc.create_fid, tcc.create_date, tcc.last_modify_date, tcc.is_del
  </sql>

  <select id="getColumnCityByFid" resultMap="BaseResultMap" parameterType="string" >
    <!--
    fid查询城市专栏
    -->
    select 
    <include refid="Base_Column_List" />
    from t_column_city tcc
    where tcc.fid = #{fid,jdbcType=VARCHAR}
  </select>
  
  <!-- 分页查询城市专栏列表 -->
  <select id="findColumnCityList"  parameterType="com.ziroom.minsu.services.cms.dto.ColumnCityRequest" resultMap="columnCityListMap">
  	SELECT <include refid="Base_Column_List" />,
  	tct.`temp_name`,tct.`temp_type` FROM `t_column_city` tcc
	LEFT JOIN `t_column_template` tct ON tcc.`temp_fid`=tct.`fid`
	WHERE tcc.`is_del`=0
	<if test="tempName != null and tempName != ''">
      AND tct.temp_name  like CONCAT(#{tempName,jdbcType=VARCHAR},'%')
    </if>
    <if test="colTitle != null and colTitle != ''">
      AND tcc.col_title  like CONCAT(#{colTitle,jdbcType=VARCHAR},'%')
    </if>
    <if test="tempType != null ">
      AND tct.temp_type  = #{tempType,jdbcType=TINYINT}
    </if>  
    <if test="cityCode != null  and cityCode!=''">
      AND tcc.city_code = #{cityCode,jdbcType=VARCHAR}
    </if> 
  </select>

  <!-- 根据cityCode查询这个城市以及其下辖的所有专栏内容-->
  <select id="findFileRegionsByCityCode" resultMap="FileColRegionMap" parameterType="string" >
    select
    <include refid="Base_Column_List" />
    from t_column_city tcc
    where tcc.col_status = '1'
    AND tcc.city_code = #{cityCode,jdbcType=VARCHAR}
    limit 1
  </select>
 
  <insert id="insertColumnCity" parameterType="com.ziroom.minsu.entity.cms.ColumnCityEntity" >
    <!--
    插入城市专栏
    -->
    insert into t_column_city
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="fid != null" >
        fid,
      </if>
      <if test="tempFid != null" >
        temp_fid,
      </if>
      <if test="cityCode != null" >
        city_code,
      </if>
      <if test="colTitle != null" >
        col_title,
      </if>
      <if test="colDeputyTitle != null" >
        col_deputy_title,
      </if>
      <if test="colShareTitle != null" >
        col_share_title,
      </if>
      <if test="colBackColor != null" >
        col_back_color,
      </if>
      <if test="colStatus != null" >
        col_status,
      </if>
      <if test="createFid != null" >
        create_fid,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date,
      </if>
      <if test="isDel != null" >
        is_del,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="fid != null" >
        #{fid,jdbcType=VARCHAR},
      </if>
      <if test="tempFid != null" >
        #{tempFid,jdbcType=VARCHAR},
      </if>
      <if test="cityCode != null" >
        #{cityCode,jdbcType=VARCHAR},
      </if>
      <if test="colTitle != null" >
        #{colTitle,jdbcType=VARCHAR},
      </if>
      <if test="colDeputyTitle != null" >
        #{colDeputyTitle,jdbcType=VARCHAR},
      </if>
      <if test="colShareTitle != null" >
        #{colShareTitle,jdbcType=VARCHAR},
      </if>
      <if test="colBackColor != null" >
        #{colBackColor,jdbcType=VARCHAR},
      </if>
      <if test="colStatus != null" >
        #{colStatus,jdbcType=TINYINT},
      </if>
      <if test="createFid != null" >
        #{createFid,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyDate != null" >
        #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        #{isDel,jdbcType=TINYINT},
      </if>
    </trim>
  </insert>

 
  <update id="updateColumnCity" parameterType="com.ziroom.minsu.entity.cms.ColumnCityEntity" >
    <!--
    	更新城市专栏
    -->
    update t_column_city
    <set >
      <if test="fid != null" >
        fid = #{fid,jdbcType=VARCHAR},
      </if>
      <if test="tempFid != null" >
        temp_fid = #{tempFid,jdbcType=VARCHAR},
      </if>
      <if test="cityCode != null" >
        city_code = #{cityCode,jdbcType=VARCHAR},
      </if>
      <if test="colTitle != null" >
        col_title = #{colTitle,jdbcType=VARCHAR},
      </if>
      <if test="colDeputyTitle != null" >
        col_deputy_title = #{colDeputyTitle,jdbcType=VARCHAR},
      </if>
      <if test="colShareTitle != null" >
        col_share_title = #{colShareTitle,jdbcType=VARCHAR},
      </if>
      <if test="colBackColor != null" >
        col_back_color = #{colBackColor,jdbcType=VARCHAR},
      </if>
      <if test="colStatus != null" >
        col_status = #{colStatus,jdbcType=TINYINT},
      </if>
      <if test="createFid != null" >
        create_fid = #{createFid,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        is_del = #{isDel,jdbcType=TINYINT},
      </if>
    </set>
    where fid = #{fid,jdbcType=VARCHAR}
  </update>
</mapper>
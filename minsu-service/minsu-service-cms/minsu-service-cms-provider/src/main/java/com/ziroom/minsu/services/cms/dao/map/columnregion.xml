<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cms.columnRegionDao" >
  <resultMap id="BaseResultMap" type="com.ziroom.minsu.entity.cms.ColumnRegionEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 10 15:42:12 CST 2016.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="fid" property="fid" jdbcType="VARCHAR" />
    <result column="column_city_fid" property="columnCityFid" jdbcType="VARCHAR" />
    <result column="region_fid" property="regionFid" jdbcType="VARCHAR" />
    <result column="house_fids" property="houseFids" jdbcType="VARCHAR" />
    <result column="show_house_num" property="showHouseNum" jdbcType="INTEGER" />
    <result column="standby_field" property="standbyField" jdbcType="VARCHAR" />
    <result column="order_sort" property="orderSort" jdbcType="INTEGER" />
    <result column="create_fid" property="createFid" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="last_modify_date" property="lastModifyDate" jdbcType="TIMESTAMP" />
    <result column="is_del" property="isDel" jdbcType="TINYINT" />
  </resultMap>
  
  <!-- 专栏景点商圈列表map -->
  <resultMap type="com.ziroom.minsu.services.cms.entity.ColumnRegionVo" id="columnRegionListMap" extends="BaseResultMap">
  	<result column="city_code" property="cityCode" jdbcType="VARCHAR" />
  	<result column="col_title" property="colTitle" jdbcType="VARCHAR" />
  </resultMap>
  
  <!-- 更新专栏景点商圈查询map -->
  <resultMap type="com.ziroom.minsu.services.cms.entity.ColumnRegionUpVo" id="columnRegionUpVoMap" extends="BaseResultMap">
  	<collection property="picList"  column="fid" javaType="ArrayList" select="cms.columnRegionPicDao.findColumnRegionPicByColumnRegionFid"></collection>
  	<collection property="itemList"  column="fid" javaType="ArrayList" select="cms.columnRegionItemDao.findColumnRegionItemByColumnRegionFid"></collection>
  </resultMap>

  <!-- 根据column_city fid查询专栏-->
  <resultMap type="com.ziroom.minsu.services.cms.entity.ColumnRegionPicVo" id="RegionsPicMap" extends="BaseResultMap">
    <result column="pic_base_url" property="picBaseUrl" jdbcType="VARCHAR" />
    <result column="pic_suffix" property="picSuffix" jdbcType="VARCHAR" />
  </resultMap>

  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 10 15:42:12 CST 2016.
    -->
    tcr.id, tcr.fid,tcr.column_city_fid,tcr.region_fid, tcr.house_fids, tcr.show_house_num, tcr.standby_field,tcr.order_sort,tcr.create_fid, tcr.create_date, 
    tcr.last_modify_date, tcr.is_del
  </sql>

  <!-- 根据column_city fid 查询专栏-->
  <select id="findRegionListAndPic" resultMap="RegionsPicMap" parameterType="string" >
    SELECT
    <include refid="Base_Column_List" />,tcrp.pic_base_url,tcrp.pic_suffix
    FROM `t_column_region` tcr
    LEFT JOIN `t_column_region_pic` tcrp ON tcrp.column_region_fid = tcr.fid
    WHERE tcr.is_del='0'
    AND tcrp.pic_type = '0'
    AND tcr.column_city_fid=#{fid,jdbcType=VARCHAR}
    ORDER BY tcr.order_sort ASC
  </select>

  <select id="findColumnRegionUpVo" resultMap="columnRegionUpVoMap" parameterType="string" >
    <!--
    更新查询专栏商圈景点
    -->
    select 
    <include refid="Base_Column_List" />
    from t_column_region tcr
    where fid = #{fid,jdbcType=VARCHAR}
  </select>
  
  <!-- 分页查询专栏景点商圈列表 -->
  <select id="findColumnRegionList"  parameterType="com.ziroom.minsu.services.cms.dto.ColumnRegionRequest" resultMap="columnRegionListMap">
  	SELECT tcc.`city_code`,tcc.`col_title`,<include refid="Base_Column_List" /> FROM `t_column_region` tcr
	LEFT JOIN `t_column_city` tcc ON tcr.`column_city_fid`=tcc.`fid`
	WHERE tcr.`is_del`=0
	AND tcr.`column_city_fid`= #{columnCityFid,jdbcType=VARCHAR}
	ORDER BY tcr.order_sort
  </select>

 
  <insert id="insertColumnRegion" parameterType="com.ziroom.minsu.entity.cms.ColumnRegionEntity" >
    <!--
    插入专栏商圈景点
    -->
    insert into t_column_region
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="fid != null" >
        fid,
      </if>
      <if test="columnCityFid != null" >
        column_city_fid,
      </if>
      <if test="regionFid != null" >
        region_fid,
      </if>
      <if test="houseFids != null" >
        house_fids,
      </if>
      <if test="showHouseNum != null" >
        show_house_num,
      </if>
      <if test="standbyField != null" >
        standby_field,
      </if>
      <if test="orderSort != null" >
        order_sort,
      </if>
      <if test="createFid != null" >
        create_fid,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date,
      </if>
      <if test="isDel != null" >
        is_del,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="fid != null" >
        #{fid,jdbcType=VARCHAR},
      </if>
      <if test="columnCityFid != null" >
        #{columnCityFid,jdbcType=VARCHAR},
      </if>
      <if test="regionFid != null" >
        #{regionFid,jdbcType=VARCHAR},
      </if>
      <if test="houseFids != null" >
        #{houseFids,jdbcType=VARCHAR},
      </if>
      <if test="showHouseNum != null" >
        #{showHouseNum,jdbcType=INTEGER},
      </if>
      <if test="standbyField != null" >
        #{standbyField,jdbcType=VARCHAR},
      </if>
      <if test="orderSort != null" >
        #{orderSort,jdbcType=INTEGER},
      </if>
      <if test="createFid != null" >
        #{createFid,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyDate != null" >
        #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        #{isDel,jdbcType=TINYINT},
      </if>
    </trim>
  </insert>


  <update id="updateColumnRegion" parameterType="com.ziroom.minsu.entity.cms.ColumnRegionEntity" >
    <!--
    更新专栏景点商圈内容
    -->
    update t_column_region
    <set >
      <if test="columnCityFid != null" >
        column_city_fid = #{columnCityFid,jdbcType=VARCHAR},
      </if> 
      <if test="regionFid != null" >
        region_fid = #{regionFid,jdbcType=VARCHAR},
      </if>
      <if test="houseFids != null" >
        house_fids = #{houseFids,jdbcType=VARCHAR},
      </if>
      <if test="showHouseNum != null" >
        show_house_num = #{showHouseNum,jdbcType=INTEGER},
      </if>
      <if test="standbyField != null" >
        standby_field = #{standbyField,jdbcType=VARCHAR},
      </if>
      <if test="orderSort != null" >
        order_sort = #{orderSort,jdbcType=INTEGER},
      </if>
      <if test="createFid != null" >
        create_fid = #{createFid,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        is_del = #{isDel,jdbcType=TINYINT},
      </if>
    </set>
    where fid = #{fid,jdbcType=VARCHAR}
  </update>
  
  <select id="findColumnRegionUpVoListByCityFid" resultMap="columnRegionUpVoMap" parameterType="string" >
    <!--
    查询城市专栏下包含商圈景点列表
    -->
    select 
    <include refid="Base_Column_List" />
    from t_column_region tcr
    where tcr.is_del=0
    and column_city_fid = #{columnCityFid,jdbcType=VARCHAR}
  </select>
  
  <!-- 查询下一个城市专栏排序号 -->
  <select id="findNextOrderSortByColumnCityFid"  resultType="int"  parameterType="string">
  	SELECT ifnull(MAX(order_sort),0)+1 FROM `t_column_region` WHERE column_city_fid=#{columnCityFid,jdbcType=VARCHAR}
  </select>
</mapper>

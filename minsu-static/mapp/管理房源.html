<!DOCTYPE>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="applicable-device" content="mobile">
	<meta content="fullscreen=yes,preventMove=yes" name="ML-Config">        
	<script type="text/javascript" src="http://minsustatic.d.ziroom.com/mapp/js/header.js?v=js.version.20160603.01001"></script>
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="yes" name="apple-touch-fullscreen"/>
	<title>修改房源</title>
	<link rel="stylesheet" type="text/css" href="css/styles_new.css">
	
</head>
<body>

	<input type="hidden" id="staticUrl" value="http://minsustatic.d.ziroom.com/mapp">
	<div class="bodys">
		<header class="header">
			<a href="我的房源.html" id="goback" class="goback" ></a>
			<h1>十里铺阳光小屋</h1>
		</header>
		<div class="main myCenterListNoneA">
			
			<div class="myBanner img">
				<a href="http://minsu.m.d.ziroom.com:80/houseInput/43e881/goToUpHousePic?houseBaseFid=8a9084df556ce43901556ce439140001&rentWay=1&houseRoomFid=8a9084df556cd72c01556ce542f00004&flag=1&pageType=1"><img src="http://10.16.34.44:8000/minsu/group1/M00/00/66/ChAiMFdnp56ACQNXABbJGX_8RZQ826.jpg_Z_1200_800.jpg" class="bg setImg"></a>
				<!-- 显示审核未通过原因 -->
				
				
					<span  class="house_status">已上架</span>
				
			</div>
			<ul class="myCenterList myCenterList_no">
				<li class="clearfix bor_b ">
					<a href="http://minsu.m.d.ziroom.com:80/houseInput/43e881/findHouseDetail?houseBaseFid=8a9084df556ce43901556ce439140001&rentWay=1&flag=1&houseRoomFid=8a9084df556cd72c01556ce542f00004">房源信息<input type="text" id="houseMessage" placeholder="修改您的房源信息" value="" readonly="readonly"></a>
					<span class="icon_r icon"></span>
				</li>
				<li class="clearfix bor_b ">
					
				    
				        
				         <a href="http://minsu.m.d.ziroom.com:80/roomMgt/43e881/roommateDetail?houseBaseFid=8a9084df556ce43901556ce439140001&roomFid=8a9084df556cd72c01556ce542f00004">房间信息<input type="text" id="houseMessage" placeholder="修改您的房间信息" value="" readonly="readonly"></a>
					     
					     
					     
				          
				    		
				    <span class="icon_r icon"></span>		
                </li>
				<li class="clearfix">
					 <a href="http://minsu.m.d.ziroom.com:80/houseIssue/43e881/showOptionalInfo?houseBaseFid=8a9084df556ce43901556ce439140001&rentWay=1&flag=1&houseRoomFid=8a9084df556cd72c01556ce542f00004">补充信息<input type="text" id="addMessage" placeholder="默认为平台规则" value="" readonly="readonly"></a>
					<span class="icon_r icon"></span>			
				</li>
				
			</ul>
			<ul class="myCenterList">
				<li class="clearfix bor_b doubleLi">				
					
						<h1>房源地址</h1>
						<p>天津市河北区和姐姐我们家 </p>
					
						
				</li>

				
					<li class="clearfix bor_b no_icon">				
						房源类型
						<input type="text" id="houseStyle" placeholder="" value="老洋房" readonly="readonly">
					</li>
				
				
					
				<li class="clearfix bor_b no_icon">
					出租类型
					<input type="text" id="rentStyle" placeholder="" value="独立房间" readonly="readonly">
				</li>
				<li class="clearfix no_icon">
					房源编码
					<input type="text" id="rentStyle" placeholder="" value="120100567910F" readonly="readonly">
				</li>
			</ul>
			<!-- 630修改 -->
			<ul class="myCenterList">
				<li class="clearfix bor_b ">
					<a href="智能门锁.html">智能门锁</a>
					<span class="icon_r icon"></span>
				</li>
			</ul>
		</div><!--/main-->
	</div>
		
		
			<div class="box box_bottom">
				<input type="button" id="downHouse" value="下架房源" class="org_btn">
			</div>
		
		
	<!-- </form> -->
	<script src="http://minsustatic.d.ziroom.com/mapp/js/jquery-2.1.1.min.js?v=js.version.20160603.01001" type="text/javascript"></script>
	<script type="text/javascript" src="http://minsustatic.d.ziroom.com/mapp/js/layer/layer.js?v=js.version.20160603.01001"></script>
	<script src="http://minsustatic.d.ziroom.com/mapp/js/common.js"></script>
	<script type="text/javascript">
	
		$(function(){
			/* 命名空间方式分开 */
			var house={};
			house.houseMsg={
				landlordUid:'eaaf194b-067e-4289-bcd7-63a9433d3ef4',
				houseFid:'8a9084df556ce43901556ce439140001',
				roomFid:'8a9084df556cd72c01556ce542f00004',
				rentWay:'1',
				delHouseMsg:'您确定要删除房源吗？',
				downHouseMsg:'如果下架您的房源，您需要对已确认的预订负责，在下架时间段内，您的房源将不会出现在房源列表中。',
				delHouseUrl:'http://minsu.m.d.ziroom.com:80/houseIssue/43e881/delHouse',
				downHouseUrl:'http://minsu.m.d.ziroom.com:80/houseIssue/43e881/downHouse',
				issueHouseUrl:'http://minsu.m.d.ziroom.com:80/houseIssue/43e881/issueHouseInDetail',
				cancleHouseUrl:'http://minsu.m.d.ziroom.com:80/houseIssue/43e881/cancleHouse',
				getRemark:'http://minsu.m.d.ziroom.com:80/houseIssue/43e881/getHouseOperLog',
				updateHouseTypeUrl:"http://minsu.m.d.ziroom.com:80/houseInput/43e881/updateHouseType",
				refuseMsg:'',
			};
			
			house.oper={
					showConfirm:function(msg,url,obj,data,type){
						var _this = this;
						 layer.open({
						    	content: '<div class="loginTips" style="line-height: 1.1rem">'+msg+'</div>',
						    	btn:['拒绝','同意'],
						    	no: function(){
						    		_this.ajaxPost(obj,url,data,type);
						        }, 
						    	yes: function(){
						        	layer.closeAll();
						        	$(obj).removeClass("disabled_btn").addClass("org_btn");
						        }
						   });
					},
					showAsk:function(){
						var data = {};
						data.houseFid = house.houseMsg.houseFid;
						data.roomFid = house.houseMsg.roomFid;
						var msg = "";
						$.getJSON(house.houseMsg.getRemark,data,function(result){
							if(result.code == 0){
								msg = result.data.remark;
							}else{
								msg = "查询错误";
							}
							//弹出提示框
							layer.open({
						    	content: '<div class="box" >'+msg+'</div>',
						    	btn:['确定'],
						    	yes: function(){
						        	layer.closeAll();
						        }
							});
						});
					},
					delHouse:function(obj){
						if($(obj).hasClass("disabled_btn")){
							return false;
						}
						$(obj).addClass("disabled_btn").removeClass("org_btn");
						var data = {};
						data.houseFid = house.houseMsg.houseFid;
						data.roomFid = house.houseMsg.roomFid;
						data.rentWay = house.houseMsg.rentWay;
						this.showConfirm(house.houseMsg.delHouseMsg,house.houseMsg.delHouseUrl,obj,data,1);
						
					},
					downHouse:function(obj){
						if($(obj).hasClass("disabled_btn")){
							return false;
						}
						$(obj).addClass("disabled_btn").removeClass("org_btn");
						var data = {};
						data.landlordUid = house.houseMsg.landlordUid;
						data.houseFid = this.getFid();
						data.rentWay = house.houseMsg.rentWay;
						this.showConfirm(house.houseMsg.downHouseMsg, house.houseMsg.downHouseUrl,obj,data);
					},
					issueHouse:function(obj){
						if($(obj).hasClass("disabled_btn")){
							return false;
						}
						$(obj).addClass("disabled_btn").removeClass("org_btn");
						var data = {};
						data.landlordUid = house.houseMsg.landlordUid;
						data.houseFid = house.houseMsg.houseFid;
						data.roomFid = house.houseMsg.roomFid;
						data.rentWay = house.houseMsg.rentWay;
						this.ajaxPost(obj,house.houseMsg.issueHouseUrl,data,2);
					},
					cancleHouse:function(obj){
						if($(obj).hasClass("disabled_btn")){
							return false;
						}
						$(obj).addClass("disabled_btn").removeClass("org_btn");
						var data = {};
						data.houseFid = house.houseMsg.houseFid;
						data.roomFid = house.houseMsg.roomFid;
						data.rentWay = house.houseMsg.rentWay;
						data.landlordUid = house.houseMsg.landlordUid;
						this.ajaxPost(obj,house.houseMsg.cancleHouseUrl,data);
					},
					getFid:function(){
						var houseFid = "";
						if(house.houseMsg.rentWay == 0){
							houseFid = house.houseMsg.houseFid;
						}else if(house.houseMsg.rentWay == 1){
							houseFid = house.houseMsg.roomFid;
						}
						return houseFid;
					},
					selectVal:function(obj,id){
						var val=$(obj).val();
					    var txt =  $(obj).find("option:selected").text();
					    $('#'+id).val(txt);
					    $.post(house.houseMsg.updateHouseTypeUrl,{fid:house.houseMsg.houseFid,houseType:val},function(){},'json');
					},
					ajaxPost:function(obj,url,data,type){
						$.ajax({
							url:url,
							data:data,
							dataType:"json",
							type:"post",
							success:function(result) {
								if(result.code === 0){
									if(type == 1){
										//如果删除则跳转到房源列表
										window.location.href = "http://minsu.m.d.ziroom.com:80/houseMgt/43e881/myHouses";
									}else{
										//否则刷新当前页面
										window.location.reload(true);
									}
								}else{
									if(type == 2){
										showShadedowTips(result.msg,1);
									}else{
										showShadedowTips("操作失败",1);
									}
									$(obj).removeClass("disabled_btn").addClass("org_btn");
								}
							},
							error:function(result){
								showShadedowTips("未知错误",1);
								$(obj).removeClass("disabled_btn").addClass("org_btn");
							}
						});
					}
				};
			
				$("#deleteHouse").click(function(){
					house.oper.delHouse(this);
				});
				
				$("#cancleHouse").click(function(){
					house.oper.cancleHouse(this);
				});
				
				$("#downHouse").click(function(){
					house.oper.downHouse(this);
				});
				
				$("#issueHouse").click(function(){
					house.oper.issueHouse(this);
				});
				
				$("#askBtn").click(function(){
					house.oper.showAsk();
				});
				
				$("#checkInLimitSelect").change(function(){
					house.oper.selectVal(this,"checkInLimit");
				});
		})
		
		
</script>

</body>
</html>
